# โ ุฅุตูุงุญ ูุดููุฉ ูุงูุฐุฉ ุงุณุชุฑุฌุงุน ุงููุฑุฏูุฉ

## ๐ ุงููุดููุฉ

ูุงูุช ูุงูุฐุฉ ุงุณุชุฑุฌุงุน ุงููุฑุฏูุฉ (Shift Recovery Modal) ุชุธูุฑ **ุญุชู ูู ูู ุชูู ููุงู ูุฑุฏูุฉ ููุชูุญุฉ**ุ ููุง ูุณุจุจ ุฅุฒุนุงุฌ ูููุณุชุฎุฏู.

### ุงูุณุจุจ

ุงูููุฏ ุงููุฏูู ูุงู ูุนุฑุถ ุงููุงูุฐุฉ ุฅุฐุง:
1. ููุฌุฏ shift ูุญููุธ ูู localStorage
2. ูุง ููุฌุฏ shift ุญุงูู ูู API

ุงููุดููุฉ: ุงูุดุฑุท ุงูุซุงูู (`!currentShift`) ูุงู ูุชุญูู **ุญุชู ูุจู ุชุญููู API**ุ ููุง ูุนูู ุฃู ุงููุงูุฐุฉ ุชุธูุฑ ุฏุงุฆูุงู ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู.

```typescript
// โ ุงูููุฏ ุงููุฏูู (ุฎุงุทุฆ)
if (saved && !currentShift) {
  setShowRecovery(true);
}
```

---

## โ ุงูุญู

### 1. ุชุญุณูู ุดุฑุท ุนุฑุถ ุงููุงูุฐุฉ ูู `App.tsx`

```typescript
// โ ุงูููุฏ ุงูุฌุฏูุฏ (ุตุญูุญ)
const { data: currentShiftData, isLoading: isLoadingShift } = useGetCurrentShiftQuery(undefined, {
  skip: !isAuthenticated,
});

useEffect(() => {
  if (!isAuthenticated) return;
  
  // ุงูุชุธุฑ ุญุชู ูุชู ุชุญููู API
  if (isLoadingShift) return;

  const saved = shiftPersistence.load();
  const currentShift = currentShiftData?.data;

  // ุงุนุฑุถ ุงููุงูุฐุฉ ููุท ุฅุฐุง:
  // 1. ููุฌุฏ shift ูุญููุธ ูู localStorage
  // 2. API ุชู ุชุญูููู (ููุณ ูู ุญุงูุฉ loading)
  // 3. ููุฌุฏ shift ููุชูุญ ุญุงููุงู ูู API
  // 4. ุงูู shift ุงููุญููุธ ูุทุงุจู ุงูู shift ุงูุญุงูู
  if (saved && currentShift && !currentShift.isClosed && saved.shift.id === currentShift.id) {
    setRecoveredShift(saved.shift);
    setSavedAt(saved.savedAt);
    setShowRecovery(true);
  } else if (saved && !currentShift) {
    // ุฅุฐุง ูุงู ููุงู shift ูุญููุธ ููู ูุง ููุฌุฏ shift ุญุงููุ ุงูุณุญู
    shiftPersistence.clear();
  }
}, [isAuthenticated, currentShiftData, isLoadingShift]);
```

### 2. ุชูุธูู localStorage ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ

ูู `authSlice.ts`:

```typescript
import { shiftPersistence } from "../../utils/shiftPersistence";

logout: (state) => {
  state.user = null;
  state.token = null;
  state.isAuthenticated = false;
  // ุงูุณุญ shift persistence ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ
  shiftPersistence.clear();
}
```

### 3. ุชูุธูู localStorage ุนูุฏ ุฅุบูุงู ุงููุฑุฏูุฉ

ูู `ShiftPage.tsx`:

```typescript
import { shiftPersistence } from "@/utils/shiftPersistence";

const handleCloseShift = async () => {
  await closeShift({ closingBalance: Number(closingBalance), notes });
  // ุงูุณุญ shift persistence ุนูุฏ ุฅุบูุงู ุงููุฑุฏูุฉ
  shiftPersistence.clear();
  setShowCloseModal(false);
  setClosingBalance("");
  setNotes("");
};
```

---

## ๐ฏ ุงููุชูุฌุฉ

ุงูุขู ูุงูุฐุฉ ุงุณุชุฑุฌุงุน ุงููุฑุฏูุฉ ุชุธูุฑ **ููุท** ูู ุงูุญุงูุงุช ุงูุตุญูุญุฉ:

### โ ูุชู ุชุธูุฑ ุงููุงูุฐุฉุ

1. **ุงููุณุชุฎุฏู ูุชุญ ูุฑุฏูุฉ**
2. **ุงูุชุทุจูู ุชุนุทู ุฃู ุงููุชุตูุญ ุฃูุบูู ูุฌุฃุฉ**
3. **ุงููุณุชุฎุฏู ูุชุญ ุงูุชุทุจูู ูุฑุฉ ุฃุฎุฑู**
4. **ุงููุฑุฏูุฉ ูุง ุฒุงูุช ููุชูุญุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**

### โ ูุชู ูุง ุชุธูุฑ ุงููุงูุฐุฉุ

1. โ ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู ูุฃูู ูุฑุฉ (ูุง ุชูุฌุฏ ูุฑุฏูุฉ ููุชูุญุฉ)
2. โ ุจุนุฏ ุฅุบูุงู ุงููุฑุฏูุฉ ุจุดูู ุทุจูุนู
3. โ ุจุนุฏ ุชุณุฌูู ุงูุฎุฑูุฌ
4. โ ุฅุฐุง ูุงูุช ุงููุฑุฏูุฉ ูุบููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ 1: ุชุณุฌูู ุฏุฎูู ุนุงุฏู (ูุฌุจ ุฃูุง ุชุธูุฑ ุงููุงูุฐุฉ)
1. ุณุฌู ุฏุฎูู ุจุญุณุงุจ ุฌุฏูุฏ
2. **ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ูุง ุชุธูุฑ ูุงูุฐุฉ ุงูุงุณุชุฑุฌุงุน โ

### ุงุฎุชุจุงุฑ 2: ุงุณุชุฑุฌุงุน ูุฑุฏูุฉ ุจุนุฏ ุชุนุทู (ูุฌุจ ุฃู ุชุธูุฑ ุงููุงูุฐุฉ)
1. ุณุฌู ุฏุฎูู
2. ุงูุชุญ ูุฑุฏูุฉ
3. ุฃุบูู ุงููุชุตูุญ ูุฌุฃุฉ (Ctrl+W ุฃู Alt+F4)
4. ุงูุชุญ ุงููุชุตูุญ ูุฑุฉ ุฃุฎุฑู ูุณุฌู ุฏุฎูู
5. **ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ุชุธูุฑ ูุงูุฐุฉ ุงูุงุณุชุฑุฌุงุน โ

### ุงุฎุชุจุงุฑ 3: ุจุนุฏ ุฅุบูุงู ุงููุฑุฏูุฉ (ูุฌุจ ุฃูุง ุชุธูุฑ ุงููุงูุฐุฉ)
1. ุงูุชุญ ูุฑุฏูุฉ
2. ุฃุบูู ุงููุฑุฏูุฉ ุจุดูู ุทุจูุนู
3. ุณุฌู ุฎุฑูุฌ ูุณุฌู ุฏุฎูู ูุฑุฉ ุฃุฎุฑู
4. **ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ูุง ุชุธูุฑ ูุงูุฐุฉ ุงูุงุณุชุฑุฌุงุน โ

### ุงุฎุชุจุงุฑ 4: ุจุนุฏ ุชุณุฌูู ุงูุฎุฑูุฌ (ูุฌุจ ุฃูุง ุชุธูุฑ ุงููุงูุฐุฉ)
1. ุงูุชุญ ูุฑุฏูุฉ
2. ุณุฌู ุฎุฑูุฌ
3. ุณุฌู ุฏุฎูู ูุฑุฉ ุฃุฎุฑู
4. **ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ูุง ุชุธูุฑ ูุงูุฐุฉ ุงูุงุณุชุฑุฌุงุน โ

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

1. โ `client/src/App.tsx` - ุชุญุณูู ุดุฑุท ุนุฑุถ ุงููุงูุฐุฉ
2. โ `client/src/store/slices/authSlice.ts` - ุชูุธูู ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ
3. โ `client/src/pages/shifts/ShiftPage.tsx` - ุชูุธูู ุนูุฏ ุฅุบูุงู ุงููุฑุฏูุฉ

---

## โ ุชู ุงูุฅุตูุงุญ!

ุงููุดููุฉ ุชู ุญููุง ุจุงููุงูู. ูุงูุฐุฉ ุงูุงุณุชุฑุฌุงุน ุงูุขู ุชุนูู ุจุดูู ุตุญูุญ ูุชุธูุฑ ููุท ุนูุฏูุง ูููู ุฐูู ุถุฑูุฑูุงู.
