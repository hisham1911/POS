# โ ููุฒุฉ ุงูุจูุน ุงูุขุฌู - ุงูุชููุช

## ๐ ุงูููุฎุต

ุชู ุชูููุฐ ููุฒุฉ ุงูุจูุน ุงูุขุฌู (Credit Sales) ุจูุฌุงุญุ ูุงูุชู ุชุณูุญ ููุนููุงุก ุจุงูุฏูุน ุงูุฌุฒุฆู ููุทูุจุงุช ูุน ุชุณุฌูู ุงููุจูุบ ุงููุณุชุญู ูุฏูู ุนูู ุญุณุงุจ ุงูุนููู.

---

## ๐ฏ ุงูููุฒุงุช ุงููููุฐุฉ

### Backend

#### 1. **ุชุญุฏูุซ Entity - Customer**
- ุฅุถุงูุฉ ุญูู `TotalDue` (decimal): ุฅุฌูุงูู ุงููุจูุบ ุงููุณุชุญู ุนูู ุงูุนููู
- ุฅุถุงูุฉ ุญูู `CreditLimit` (decimal): ุงูุญุฏ ุงูุฃูุตู ููุงุฆุชูุงู ุงููุณููุญ (0 = ุจุฏูู ุญุฏ)

#### 2. **Migration**
- Migration: `AddCustomerCreditTracking`
- ุชู ุฅุถุงูุฉ ุงูุญููู ุงูุฌุฏูุฏุฉ ูุน ููู ุงูุชุฑุงุถูุฉ = 0

#### 3. **ุชุญุฏูุซ CustomerService**
```csharp
// Methods ุฌุฏูุฏุฉ
Task UpdateCreditBalanceAsync(int customerId, decimal amountDue);
Task<bool> ValidateCreditLimitAsync(int customerId, decimal additionalAmount);
```

#### 4. **ุชุญุฏูุซ OrderService.CompleteAsync**
- ุงูุณูุงุญ ุจุงูุฏูุน ุงูุฌุฒุฆู ุฅุฐุง ูุงู ุงูุทูุจ ูุฑุชุจุท ุจุนููู
- ุงูุชุญูู ูู ุญุฏ ุงูุงุฆุชูุงู ูุจู ูุจูู ุงูุฏูุน ุงูุฌุฒุฆู
- ุชุญุฏูุซ `Customer.TotalDue` ุชููุงุฆูุงู ุนูุฏ ูุฌูุฏ ูุจูุบ ูุณุชุญู

#### 5. **Error Codes**
- `CUSTOMER_CREDIT_LIMIT_EXCEEDED`: ุชุฌุงูุฒ ุญุฏ ุงูุงุฆุชูุงู ุงููุณููุญ

#### 6. **DTOs**
- ุชุญุฏูุซ `CustomerDto` ูุชุดูู `TotalDue` ู `CreditLimit`
- ุชุญุฏูุซ `UpdateCustomerRequest` ูุชุดูู `CreditLimit`

---

### Frontend

#### 1. **ุชุญุฏูุซ Types**
```typescript
interface Customer {
  // ... existing fields
  totalDue: number;
  creditLimit: number;
}
```

#### 2. **ุชุญุฏูุซ PaymentModal**
- ุฅุถุงูุฉ checkbox "ุงูุณูุงุญ ุจุงูุฏูุน ุงูุฌุฒุฆู (ุจูุน ุขุฌู)"
- ุนุฑุถ ุงููุจูุบ ุงููุณุชุญู ุนูุฏ ุงูุฏูุน ุงูุฌุฒุฆู
- ุนุฑุถ ุฑุตูุฏ ุงูุนููู ุงูุญุงูู ูุญุฏ ุงูุงุฆุชูุงู
- ุงูุชุญูู ูู ุญุฏ ุงูุงุฆุชูุงู ูุจู ุฅุชูุงู ุงูุนูููุฉ
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ุนูุฏ ุชุฌุงูุฒ ุงูุญุฏ

#### 3. **UI/UX**
- ุนุฑุถ `TotalDue` ูู ูุนูููุงุช ุงูุนููู ุจููู ุจุฑุชูุงูู
- ุนุฑุถ `CreditLimit` ููุนูููุฉ ุฅุถุงููุฉ
- ุชุญุฐูุฑ ุจุตุฑู ุนูุฏ ุชุฌุงูุฒ ุญุฏ ุงูุงุฆุชูุงู (ููู ุฃุญูุฑ)
- ุฑุณุงูุฉ ูุฌุงุญ ุชูุถุญ ุงููุจูุบ ุงููุณุชุญู ุนูุฏ ุฅุชูุงู ุงูุจูุน ุงูุขุฌู

---

## ๐ ุณูุฑ ุงูุนูู (Workflow)

### 1. **ุฅุนุฏุงุฏ ุงูุนููู**
```
1. ุฅูุดุงุก/ุชุญุฏูุซ ุนููู
2. ุชุญุฏูุฏ ุญุฏ ุงูุงุฆุชูุงู (ุงุฎุชูุงุฑู)
   - 0 = ุจุฏูู ุญุฏ
   - > 0 = ุญุฏ ูุญุฏุฏ
```

### 2. **ุงูุจูุน ุงูุขุฌู**
```
1. ุฅุถุงูุฉ ููุชุฌุงุช ููุณูุฉ
2. ุงุฎุชูุงุฑ ุนููู
3. ูุชุญ ูุงูุฐุฉ ุงูุฏูุน
4. ุชูุนูู "ุงูุณูุงุญ ุจุงูุฏูุน ุงูุฌุฒุฆู"
5. ุฅุฏุฎุงู ุงููุจูุบ ุงููุฏููุน (ุฃูู ูู ุงูุฅุฌูุงูู)
6. ุงููุธุงู ูุชุญูู ูู:
   - ูุฌูุฏ ุนููู ูุฑุชุจุท โ
   - ุนุฏู ุชุฌุงูุฒ ุญุฏ ุงูุงุฆุชูุงู โ
7. ุฅุชูุงู ุงูุจูุน
8. ุชุญุฏูุซ Customer.TotalDue ุชููุงุฆูุงู
```

### 3. **ุงูุชุญูู ูู ุญุฏ ุงูุงุฆุชูุงู**
```csharp
if (CreditLimit == 0) 
    return true; // ุจุฏูู ุญุฏ

if ((TotalDue + NewAmountDue) <= CreditLimit)
    return true; // ุถูู ุงูุญุฏ

return false; // ุชุฌุงูุฒ ุงูุญุฏ
```

---

## ๐ ูุซุงู ุนููู

### ุงูุณููุงุฑูู
- ุนููู: ุฃุญูุฏ ูุญูุฏ
- ุญุฏ ุงูุงุฆุชูุงู: 1000 ุฌ.ู
- ุฑุตูุฏ ูุณุชุญู ุญุงูู: 200 ุฌ.ู

### ุนูููุฉ ุจูุน ุฌุฏูุฏุฉ
- ุฅุฌูุงูู ุงูุทูุจ: 500 ุฌ.ู
- ุงููุจูุบ ุงููุฏููุน: 300 ุฌ.ู
- ุงููุจูุบ ุงููุณุชุญู: 200 ุฌ.ู

### ุงูุชุญูู
```
ุงูุฑุตูุฏ ุงูุฌุฏูุฏ = 200 (ุญุงูู) + 200 (ุฌุฏูุฏ) = 400 ุฌ.ู
400 <= 1000 โ (ูุณููุญ)
```

### ุงููุชูุฌุฉ
- Order.AmountPaid = 300
- Order.AmountDue = 200
- Customer.TotalDue = 400 (ุชู ุงูุชุญุฏูุซ)

---

## โ Validation Rules

| Rule | Error Code | Message |
|------|------------|---------|
| Partial payment requires customer | `PAYMENT_INSUFFICIENT` | ุงูุจูุน ุงูุขุฌู ูุชุทูุจ ุฑุจุท ุนููู ุจุงูุทูุจ |
| Credit limit exceeded | `CUSTOMER_CREDIT_LIMIT_EXCEEDED` | ุชุฌุงูุฒ ุญุฏ ุงูุงุฆุชูุงู ุงููุณููุญ |
| Amount paid < total (no customer) | `PAYMENT_INSUFFICIENT` | ุงููุจูุบ ุงููุฏููุน ุฃูู ูู ุงูุฅุฌูุงูู |

---

## ๐งช Testing

### Test Cases
1. โ ุจูุน ุขุฌู ุจุฏูู ุญุฏ ุงุฆุชูุงู (CreditLimit = 0)
2. โ ุจูุน ุขุฌู ุถูู ุญุฏ ุงูุงุฆุชูุงู
3. โ ุจูุน ุขุฌู ูุชุฌุงูุฒ ุญุฏ ุงูุงุฆุชูุงู
4. โ ุจูุน ุขุฌู ุจุฏูู ุนููู ูุฑุชุจุท
5. โ ุฏูุน ูุงูู (ูุง ูุคุซุฑ ุนูู TotalDue)

### Manual Testing
```bash
# 1. Start Backend
cd src/KasserPro.API
dotnet run

# 2. Start Frontend
cd client
npm run dev

# 3. Test Flow
- Login as Cashier
- Open Shift
- Add products to cart
- Select customer
- Open payment modal
- Enable "Allow Partial Payment"
- Enter amount < total
- Complete order
- Verify Customer.TotalDue updated
```

---

## ๐ Notes

### Future Enhancements
1. **ุชุณุฏูุฏ ุงูุฏููู**: ุฅุถุงูุฉ ูุงุฌูุฉ ูุชุณุฏูุฏ ุงููุจุงูุบ ุงููุณุชุญูุฉ
2. **ุชูุงุฑูุฑ ุงูุฏููู**: ุชูุฑูุฑ ุจุงูุนููุงุก ุงูุฐูู ูุฏููู ุฏููู
3. **ุชูุจููุงุช**: ุชูุจูู ุนูุฏ ุงูุชุฑุงุจ ุงูุนููู ูู ุญุฏ ุงูุงุฆุชูุงู
4. **ุณุฌู ุงูุฏููู**: ุชุชุจุน ุชุงุฑูุฎ ุงูุฏููู ูุงูุชุณุฏูุฏุงุช

### Database Schema
```sql
-- Customers table
ALTER TABLE Customers ADD COLUMN TotalDue DECIMAL(18,2) DEFAULT 0;
ALTER TABLE Customers ADD COLUMN CreditLimit DECIMAL(18,2) DEFAULT 0;
```

---

## ๐ Status: COMPLETE

ุชู ุชูููุฐ ุงูููุฒุฉ ุจูุฌุงุญ ูุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู!

**Backend**: โ Running on port 5243  
**Frontend**: Ready for testing  
**Database**: Migrations applied  
**Types**: Synced between Frontend & Backend


---

## ๐ ุฃูู ุชุธูุฑ ูุนูููุงุช ุงูุงุฆุชูุงูุ

### 1. **ุตูุญุฉ ุงูุนููุงุก (CustomersPage)**
- ุนููุฏ "ุงููุจูุบ ุงููุณุชุญู" ูู ุงูุฌุฏูู (ูุธูุฑ ุนูู ุงูุดุงุดุงุช ุงููุจูุฑุฉ xl)
- ูุนุฑุถ ุงููุจูุบ ุงููุณุชุญู ุจููู ุจุฑุชูุงูู
- ูุนุฑุถ ุญุฏ ุงูุงุฆุชูุงู ุฃุณูู ุงููุจูุบ (ูุซุงู: "ูู 1000 ุฌ.ู")

### 2. **ูุงูุฐุฉ ุชูุงุตูู ุงูุนููู (CustomerDetailsModal)**
- **ุดุฑูุท ุงูุฅุญุตุงุฆูุงุช**: ูุนุฑุถ ุงููุจูุบ ุงููุณุชุญู ูุจุทุงูุฉ ูููุตูุฉ ูุน ุญุฏ ุงูุงุฆุชูุงู
- **ุชุจููุจ ุงูุชูุงุตูู**: ูุณู "ูุนูููุงุช ุงูุงุฆุชูุงู" ูุนุฑุถ:
  - ุงููุจูุบ ุงููุณุชุญู (ุจุฎุท ูุจูุฑ ุจุฑุชูุงูู)
  - ุญุฏ ุงูุงุฆุชูุงู
  - ุงููุจูุบ ุงููุชุงุญ (ุจููู ุฃุฎุถุฑ)
  - ุดุฑูุท ุชูุฏู ููุถุญ ูุณุจุฉ ุงุณุชุฎุฏุงู ุงูุงุฆุชูุงู:
    - ุฃุฎุถุฑ: ุฃูู ูู 50%
    - ุจุฑุชูุงูู: 50% - 80%
    - ุฃุญูุฑ: ุฃูุซุฑ ูู 80%

### 3. **ูุงูุฐุฉ ุงูุฏูุน (PaymentModal)**
- ูุนุฑุถ ุงูุฑุตูุฏ ุงููุณุชุญู ุงูุญุงูู ููุนููู (ุฅู ูุฌุฏ)
- ูุนุฑุถ ุญุฏ ุงูุงุฆุชูุงู
- checkbox "ุงูุณูุงุญ ุจุงูุฏูุน ุงูุฌุฒุฆู (ุจูุน ุขุฌู)"
- ุชุญุฐูุฑ ุจุตุฑู ุนูุฏ ุชุฌุงูุฒ ุญุฏ ุงูุงุฆุชูุงู (ููู ุฃุญูุฑ)
- ุนุฑุถ ุงููุจูุบ ุงููุณุชุญู ุงูุฌุฏูุฏ ุจุนุฏ ุงูุนูููุฉ

### 4. **ูููุฐุฌ ุชุนุฏูู ุงูุนููู (CustomerFormModal)**
- ุญูู "ุญุฏ ุงูุงุฆุชูุงู (ุฌ.ู)" (ูุธูุฑ ููุท ุนูุฏ ุงูุชุนุฏูู)
- ูููู ุชุญุฏูุฏ ุญุฏ ุงุฆุชูุงู ูุญุฏุฏ ุฃู 0 ููุงุฆุชูุงู ุบูุฑ ุงููุญุฏูุฏ
- ููุงุญุธุฉ ุชูุถูุญูุฉ: "ุงุชุฑู 0 ููุณูุงุญ ุจุงุฆุชูุงู ุบูุฑ ูุญุฏูุฏ"

---

## ๐ฏ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุฅุนุฏุงุฏ ุญุฏ ุงูุงุฆุชูุงู ููุนููู
```
1. ุงุฐูุจ ุฅูู ุตูุญุฉ ุงูุนููุงุก
2. ุงุถุบุท ุนูู "ุชุนุฏูู" ููุนููู ุงููุทููุจ
3. ุฃุฏุฎู ุญุฏ ุงูุงุฆุชูุงู (ูุซุงู: 1000 ุฌ.ู)
   - 0 = ุจุฏูู ุญุฏ
   - > 0 = ุญุฏ ูุญุฏุฏ
4. ุงุญูุธ ุงูุชุนุฏููุงุช
```

### ุงูุจูุน ุงูุขุฌู
```
1. ุฃุถู ููุชุฌุงุช ููุณูุฉ ูู ููุทุฉ ุงูุจูุน
2. ุงุฎุชุฑ ุงูุนููู
3. ุงุถุบุท "ุฏูุน"
4. ูุนูู "ุงูุณูุงุญ ุจุงูุฏูุน ุงูุฌุฒุฆู"
5. ุฃุฏุฎู ุงููุจูุบ ุงููุฏููุน (ุฃูู ูู ุงูุฅุฌูุงูู)
6. ุชุญูู ูู ุนุฏู ุชุฌุงูุฒ ุญุฏ ุงูุงุฆุชูุงู
7. ุงุถุบุท "ุฅุชูุงู ุงูุจูุน ุงูุขุฌู"
```

### ูุชุงุจุนุฉ ุงูุฏููู
```
1. ุงุฐูุจ ุฅูู ุตูุญุฉ ุงูุนููุงุก
2. ุงูุธุฑ ุฅูู ุนููุฏ "ุงููุจูุบ ุงููุณุชุญู"
3. ุฃู ุงุถุบุท ุนูู "ุนุฑุถ ุงูุชูุงุตูู" ูุฑุคูุฉ:
   - ุงููุจูุบ ุงููุณุชุญู
   - ุญุฏ ุงูุงุฆุชูุงู
   - ุงููุจูุบ ุงููุชุงุญ
   - ูุณุจุฉ ุงูุงุณุชุฎุฏุงู
   - ุณุฌู ุงูุทูุจุงุช
```

---

## ๐จ UI/UX Features

### ุฃููุงู ูููุฒุฉ
- **ุจุฑุชูุงูู**: ุงููุจูุบ ุงููุณุชุญู
- **ุฃุฎุถุฑ**: ุงููุจูุบ ุงููุชุงุญ
- **ุฃุญูุฑ**: ุชุญุฐูุฑ ุชุฌุงูุฒ ุงูุญุฏ

### ุดุฑูุท ุงูุชูุฏู
- ููุถุญ ูุณุจุฉ ุงุณุชุฎุฏุงู ุงูุงุฆุชูุงู ุจุตุฑูุงู
- ูุชุบูุฑ ุงูููู ุญุณุจ ุงููุณุจุฉ (ุฃุฎุถุฑ โ ุจุฑุชูุงูู โ ุฃุญูุฑ)

### ุฑุณุงุฆู ูุงุถุญุฉ
- "ุงูุจูุน ุงูุขุฌู ูุชุทูุจ ุฑุจุท ุนููู ุจุงูุทูุจ"
- "ุชุฌุงูุฒ ุญุฏ ุงูุงุฆุชูุงู ุงููุณููุญ"
- "ุชู ุฅุชูุงู ุงูุจูุน ุงูุขุฌู! ุงููุจูุบ ุงููุณุชุญู: XXX ุฌ.ู"
