# ุชูููุฐ ุงูุฅุบูุงู ุงูุชููุงุฆู ูููุฑุฏูุงุช

## โ ูุง ุชู ุชูููุฐู

ุชู ุชูููุฐ ูุธุงู ุงูุฅุบูุงู ุงูุชููุงุฆู ูููุฑุฏูุงุช ุจุนุฏ 12 ุณุงุนุฉ ูุฅุฒุงูุฉ ูุธุงู ุงูุชูุจููุงุช ุงููุฏูู ููุง ุทูุจุช.

---

## ๐ง ุงูุชุบููุฑุงุช ูู Backend

### 1. ุฎุฏูุฉ ุงูุฅุบูุงู ุงูุชููุงุฆู (Background Service)

**ุงูููู:** `src/KasserPro.Infrastructure/Services/AutoCloseShiftBackgroundService.cs`

- ุฎุฏูุฉ ุชุนูู ูู ุงูุฎูููุฉ ุชูุญุต ุงููุฑุฏูุงุช ูู ุณุงุนุฉ
- ุชุบูู ุชููุงุฆูุงู ุฃู ูุฑุฏูุฉ ููุชูุญุฉ ูุฃูุซุฑ ูู 12 ุณุงุนุฉ
- ุชุญุณุจ ุงูุฅุฌูุงููุงุช ูู ุงูุทูุจุงุช ุงูููุชููุฉ
- ุชุณุฌู ุงูุฅุบูุงู ูู Force Close ุจุณุจุจ "ุฅุบูุงู ุชููุงุฆู - ุชุฌุงูุฒุช 12 ุณุงุนุฉ"
- ุงููุณุชุฎุฏู ุงูุฐู ุฃุบูู = "ุงููุธุงู"

**ุงููููุฒุงุช:**
- ูููู ุชูุนูู/ุชุนุทูู ุงูุฎุฏูุฉ ูู ุงูุฅุนุฏุงุฏุงุช
- ูููู ุชุบููุฑ ุนุฏุฏ ุงูุณุงุนุงุช (ุงูุชุฑุงุถู: 12 ุณุงุนุฉ)
- ุชุณุฌูู ูุงูู (Logging) ููู ุนูููุฉ ุฅุบูุงู
- ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ููู ูุฑุฏูุฉ ุนูู ุญุฏุฉ

### 2. ุงูุฅุนุฏุงุฏุงุช

**ุงูููู:** `src/KasserPro.API/appsettings.json`

```json
"ShiftAutoClose": {
  "Enabled": true,
  "HoursThreshold": 12
}
```

- `Enabled`: ุชูุนูู/ุชุนุทูู ุงูุฅุบูุงู ุงูุชููุงุฆู
- `HoursThreshold`: ุนุฏุฏ ุงูุณุงุนุงุช ูุจู ุงูุฅุบูุงู ุงูุชููุงุฆู

### 3. ุชุณุฌูู ุงูุฎุฏูุฉ

**ุงูููู:** `src/KasserPro.API/Program.cs`

ุชู ุชุณุฌูู ุงูุฎุฏูุฉ ูู Hosted Service:
```csharp
builder.Services.AddHostedService<AutoCloseShiftBackgroundService>();
```

---

## ๐จ ุงูุชุบููุฑุงุช ูู Frontend

### 1. ุฅุฒุงูุฉ ุชูุจููุงุช ุนุฏู ุงููุดุงุท

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `client/src/pages/shifts/ShiftPage.tsx`
- `client/src/components/shifts/ActiveShiftsList.tsx`

**ูุง ุชู ุฅุฒุงูุชู:**
- โ ุชูุจูู "ุชุญุฐูุฑ: ุนุฏู ูุดุงุท ุทููู" ูู ุตูุญุฉ ุงููุฑุฏูุงุช
- โ ุดุงุฑุฉ "โฐ ุนุฏู ูุดุงุท ููุฐ X ุณุงุนุฉ" ูู ูุงุฆูุฉ ุงููุฑุฏูุงุช ุงูููุชูุญุฉ
- โ ูุฑุงูุจุฉ ูุดุงุท ุงููุณุชุฎุฏู (useInactivityMonitor)
- โ ูุงูุฐุฉ InactivityAlertModal
- โ ุนุฑุถ "ุขุฎุฑ ูุดุงุท" ูู ูุงุฆูุฉ ุงููุฑุฏูุงุช

**ูุง ุชู ุงูุงุญุชูุงุธ ุจู:**
- โ ุนุฑุถ ุงูุฑุตูุฏ ุงูููุฏู ุจุฏูุงู ูู ุขุฎุฑ ูุดุงุท
- โ ุฌููุน ุงููุธุงุฆู ุงูุฃุฎุฑู (ูุชุญุ ุฅุบูุงูุ ุชุณูููุ ุฅุบูุงู ุจุงูููุฉ)

---

## ๐ ููู ูุนูู ุงููุธุงู ุงูุฌุฏูุฏ

### ุณููุงุฑูู 1: ูุฑุฏูุฉ ุนุงุฏูุฉ
1. ุงููุงุดูุฑ ููุชุญ ุงููุฑุฏูุฉ ุงูุณุงุนุฉ 9:00 ุตุจุงุญุงู
2. ูุนูู ุทูุงู ุงูููู
3. ูุบูู ุงููุฑุฏูุฉ ุงูุณุงุนุฉ 5:00 ูุณุงุกู
4. โ ูู ุดูุก ุทุจูุนู

### ุณููุงุฑูู 2: ุงููุงุดูุฑ ูุณู ุฅุบูุงู ุงููุฑุฏูุฉ
1. ุงููุงุดูุฑ ููุชุญ ุงููุฑุฏูุฉ ุงูุณุงุนุฉ 9:00 ุตุจุงุญุงู
2. ููุณู ุฅุบูุงููุง ููุฐูุจ ููููุฒู
3. ุงูุณุงุนุฉ 9:00 ูุณุงุกู (ุจุนุฏ 12 ุณุงุนุฉ):
   - โ๏ธ ุงููุธุงู ููุญุต ุงููุฑุฏูุงุช ุชููุงุฆูุงู
   - ๐ ูุบูู ุงููุฑุฏูุฉ ุชููุงุฆูุงู
   - ๐ ูุณุฌู: "ุฅุบูุงู ุชููุงุฆู - ุชุฌุงูุฒุช 12 ุณุงุนุฉ"
   - ๐ค ุงููุณุชุฎุฏู: "ุงููุธุงู"
   - โ ุงููุฑุฏูุฉ ูุบููุฉ ุจุฃูุงู

### ุณููุงุฑูู 3: ุงููุฏูุฑ ูุฑูุฏ ุฅุบูุงู ูุฑุฏูุฉ ูุฏููุฉ
1. ุงููุฏูุฑ ูุฑู ูุฑุฏูุฉ ููุชูุญุฉ ููุฐ 8 ุณุงุนุงุช
2. ูุถุบุท "ุฅุบูุงู ุจุงูููุฉ"
3. โ ูุบูููุง ูุฏููุงู ูุจู ุงูุฅุบูุงู ุงูุชููุงุฆู

---

## ๐ ูุนูููุงุช ุงูุฅุบูุงู ุงูุชููุงุฆู

ุนูุฏ ุงูุฅุบูุงู ุงูุชููุงุฆูุ ูุชู:

1. **ุญุณุงุจ ุงูุฅุฌูุงููุงุช:**
   - ุฅุฌูุงูู ุงูููุฏู ูู ุงูุทูุจุงุช ุงูููุชููุฉ
   - ุฅุฌูุงูู ุงูุจุทุงูุงุช ูู ุงูุทูุจุงุช ุงูููุชููุฉ
   - ุนุฏุฏ ุงูุทูุจุงุช ุงูููุชููุฉ

2. **ุชุนููู ุงูููู:**
   - `ClosingBalance` = `OpeningBalance` + `TotalCash`
   - `ExpectedBalance` = `OpeningBalance` + `TotalCash`
   - `Difference` = 0 (ูุง ููุฌุฏ ูุฑู ูุฃููุง ูุณุชุฎุฏู ุงูุฑุตูุฏ ุงููุชููุน)

3. **ุชุณุฌูู ุงูุฅุบูุงู:**
   - `IsClosed` = true
   - `IsForceClosed` = true
   - `ForceClosedByUserName` = "ุงููุธุงู"
   - `ForceCloseReason` = "ุฅุบูุงู ุชููุงุฆู - ุชุฌุงูุฒุช 12 ุณุงุนุฉ"

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ ุงูุฅุบูุงู ุงูุชููุงุฆู

**ุงูุทุฑููุฉ ุงูุณุฑูุนุฉ (ููุชุทููุฑ):**
1. ุงูุชุญ `appsettings.json`
2. ุบูุฑ `HoursThreshold` ูู 12 ุฅูู 0.1 (6 ุฏูุงุฆู)
3. ุฃุนุฏ ุชุดุบูู Backend
4. ุงูุชุญ ูุฑุฏูุฉ
5. ุงูุชุธุฑ 6 ุฏูุงุฆู
6. ุชุญูู ูู ุฃู ุงููุฑุฏูุฉ ุฃูุบููุช ุชููุงุฆูุงู

**ุงูุทุฑููุฉ ุงูุนุงุฏูุฉ:**
1. ุงูุชุญ ูุฑุฏูุฉ
2. ุงูุชุธุฑ 12 ุณุงุนุฉ
3. ุชุญูู ูู ุฃู ุงููุฑุฏูุฉ ุฃูุบููุช ุชููุงุฆูุงู

### ุงูุชุญูู ูู ุงูุณุฌูุงุช (Logs)

ุงุจุญุซ ูู ุณุฌูุงุช Backend ุนู:
```
Auto-closing shift {ShiftId} for user {UserName}
Successfully auto-closed shift {ShiftId}
```

---

## โ๏ธ ุงูุฅุนุฏุงุฏุงุช ุงููุชูุฏูุฉ

### ุชุนุทูู ุงูุฅุบูุงู ุงูุชููุงุฆู

ูู `appsettings.json`:
```json
"ShiftAutoClose": {
  "Enabled": false,
  "HoursThreshold": 12
}
```

### ุชุบููุฑ ุงููุฏุฉ

ูุฅุบูุงู ุงููุฑุฏูุงุช ุจุนุฏ 8 ุณุงุนุงุช ุจุฏูุงู ูู 12:
```json
"ShiftAutoClose": {
  "Enabled": true,
  "HoursThreshold": 8
}
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูุฎุฏูุฉ ุชูุญุต ูู ุณุงุนุฉ:** ูู ูุชู ุงูุฅุบูุงู ุจุงูุถุจุท ุจุนุฏ 12 ุณุงุนุฉุ ุจู ูู ุฃูู ูุญุต ุจุนุฏ 12 ุณุงุนุฉ (ูุฏ ูููู ุจุนุฏ 12-13 ุณุงุนุฉ)

2. **ุงููุฑุฏูุงุช ุงููุบููุฉ ุชููุงุฆูุงู ุชุธูุฑ ูู Force Closed:** ูููู ุงูุชูููุฒ ุจูููุง ูู ุฎูุงู:
   - `ForceClosedByUserName` = "ุงููุธุงู"
   - `ForceCloseReason` = "ุฅุบูุงู ุชููุงุฆู - ุชุฌุงูุฒุช 12 ุณุงุนุฉ"

3. **ูุง ููุฌุฏ ูุฑู ูู ุงูุฑุตูุฏ:** ุนูุฏ ุงูุฅุบูุงู ุงูุชููุงุฆูุ ูุณุชุฎุฏู ุงูุฑุตูุฏ ุงููุชููุน ูุฑุตูุฏ ุฅุบูุงูุ ูุฐูู `Difference` = 0

4. **ุงูุฎุฏูุฉ ุชุนูู ูู ุงูุฎูููุฉ:** ูุง ุชุญุชุงุฌ ูุฃู ุชุฏุฎู ูุฏููุ ุชุจุฏุฃ ุชููุงุฆูุงู ูุน Backend

---

## โ ุงูุฎูุงุตุฉ

ุชู ุชูููุฐ ูู ูุง ุทูุจุชู:
- โ ุฅุบูุงู ุชููุงุฆู ูููุฑุฏูุงุช ุจุนุฏ 12 ุณุงุนุฉ
- โ ุฅุฒุงูุฉ ูุธุงู ุงูุชูุจููุงุช ุงููุฏูู ุนู ุงููุฑุฏูุงุช ุบูุฑ ุงููุดุทุฉ
- โ ุชุณุฌูู ูุงูู ูุนูููุงุช ุงูุฅุบูุงู ุงูุชููุงุฆู
- โ ุฅุนุฏุงุฏุงุช ูุงุจูุฉ ููุชุฎุตูุต
- โ ูุนุงูุฌุฉ ุขููุฉ ููุฃุฎุทุงุก

ุงููุธุงู ุงูุขู ูุนูู ุจุดูู ุชููุงุฆู ุจุงููุงูู ููุง ูุญุชุงุฌ ูุฃู ุชุฏุฎู ูุฏูู! ๐
